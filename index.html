<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <div id="player" style="height: 1000px;"></div>
    <script src="https://clara-deployment.s3.amazonaws.com/threekit-player-bundle-preview-.js"></script>
    <script>
      const AUTH_TOKEN = '00daba1f-d43c-4bf9-a933-b2ad57dff5d9';
      // const AUTH_TOKEN = 'd8d39aac-de34-4d05-b782-e59667661fc3';
      const TK_ENV = 'https://preview.threekit.com/';
      threekitPlayer({
        authToken: AUTH_TOKEN,
        el: document.getElementById('player'),
        assetId: '11bc9ee1-a1a6-4918-9413-302ee079ecfe',
        //stageId: 'b537565e-3f95-46a7-ae58-4d840cb7633a',
        display: 'image',
        initialConfiguration: {
          // fabric: { assetId: '47488e7f-6ee3-412e-9aa7-ad729ba0533d' },
          fabric: { assetId: '2283ad98-6199-4322-89c5-1d7a6689c350' },
        },
        showConfigurator: true,
      }).then(async (api) => {
        window.api = api;
        const DRAG_PIXEL_SENSITIVITY = 150;
        const rotations = ['front', 'right', 'back', 'left'];
        let statDragging = false;
        let startPos = null;
        let vestView = false;
        let deltaIdx = 0;
        let curIdx = 0;
        await api.when('preloaded');
        api.tools.addTool({
          active: true,
          enabled: true,
          key: 'rotate',
          handlers: {
            drag: (ev) => {
              return {
                handle: function (ev) {
                  if (!statDragging) {
                    statDragging = true;
                    startPos = ev.clientX;
                    const config = configurator.getConfiguration();
                    if (
                      config.Jacket === 'OFF' &&
                      config.Vest &&
                      config.Vest === 'ON'
                    )
                      vestView = true;
                    else vestView = false;
                    const rotate = config['View angle'] || 'front';
                    curIdx = rotations.indexOf(rotate);
                  }
                  if (!vestView) {
                    const newDeltaIdx = Math.floor(
                      (ev.clientX - startPos) / DRAG_PIXEL_SENSITIVITY
                    );
                    if (newDeltaIdx !== deltaIdx) {
                      deltaIdx = newDeltaIdx;
                      let newIndex = (curIdx + newDeltaIdx) % 4;
                      if (newIndex <= -1) newIndex += 4;
                      configurator.setConfiguration({
                        'View angle': rotations[newIndex],
                      });
                    }
                  }
                },
                onEnd: () => {
                  statDragging = false;
                  deltaIdx = 0;
                },
              };
            },
          },
        });
        window.player = api.enableApi('player');
        configurator = await api.getConfigurator();
        configurator.prefetchAttributes(['View angle']);
        window.configurator = configurator;
      });
    </script>
  </body>
</html>
